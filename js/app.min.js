const BACKGROUND_IMAGE="images/pp3.webp",BACKGROUND_IMAGES={pp3:{path:"images/pp3.webp",textSettings:{yPositionRatio:.87,enYOffset:-30,frYOffset:30,enXOffset:-5,frXOffset:-5,fontSizeRatio:.029,maxFontSize:{en:50,fr:50},minFontSize:{en:14,fr:12}}},pp4:{path:"images/pp4.webp",name:"Pierre at Rally",textSettings:{yPositionRatio:.85,enYOffset:-30,frYOffset:20,enXOffset:5,frXOffset:5,fontSizeRatio:.029,maxFontSize:{en:50,fr:50},minFontSize:{en:14,fr:12}}},pp5:{path:"images/pp5.webp",name:"Pierre at Rally",textSettings:{yPositionRatio:.93,enYOffset:-30,frYOffset:20,enXOffset:0,frXOffset:0,fontSizeRatio:.029,maxFontSize:{en:50,fr:50},minFontSize:{en:14,fr:12}}},pp6:{path:"images/pp6.webp",name:"Pierre at Rally",textSettings:{yPositionRatio:.85,enYOffset:-35,frYOffset:50,enXOffset:30,frXOffset:30,fontSizeRatio:.034,maxFontSize:{en:50,fr:50},minFontSize:{en:14,fr:12}}}};let currentImageKey="pp4";const IMAGE_QUALITY=1,verbs=[{en:"AXE",fr:"HACHER"},{en:"CUT",fr:"COUPER"},{en:"NIX",fr:"RÉDUIRE"},{en:"SCRAP",fr:"SCRAPPER"},{en:"DUMP",fr:"JETTER"},{en:"SLASH",fr:"SLASHER"},{en:"FIX",fr:"RÉPARER"},{en:"STOP",fr:"STOPPER"},{en:"BUILD",fr:"CONSTRUIRE"},{en:"BOOST",fr:"BOOSTER"},{en:"CRUSH",fr:"ÉCRASER"},{en:"END",fr:"METTRE FIN À"},{en:"CONTROL",fr:"MAÎTRISER"},{en:"DEFUND",fr:"REMBOURSER"},{en:"REIN IN",fr:"FREINER"},{en:"FREEZE",fr:"GELER"},{en:"DRAIN",fr:"ASSÉCHER"},{en:"TACKLE",fr:"TACKLER"},{en:"UNLEASH",fr:"LIBÉRER"},{en:"UNLOCK",fr:"DÉBLOQUER"},{en:"DEFEND",fr:"DÉFENDRE"},{en:"REBUILD",fr:"RECONSTRUIRE"},{en:"IGNITE",fr:"ALLUMER"},{en:"EMPOWER",fr:"AUTONOMISER"},{en:"CHAMPION",fr:"CHAMPIONER"},{en:"EXPLOIT",fr:"EXPLOITER"},{en:"RESTORE",fr:"RESTAURER"},{en:"DISRUPT",fr:"PERTURBER"},{en:"YEET",fr:"YEETER"}],nouns=[{en:"THE TAX",fr:"LES IMPÔTS"},{en:"THE BUDGET",fr:"LE BUDGET"},{en:"MY MISERY",fr:"MA MISÈRE"},{en:"MY AGONY",fr:"MA SOUFFRANCE"},{en:"MY PAIN",fr:"MA DOULEUR"},{en:"MY ANGUISH",fr:"MON ANGOISSE"},{en:"MY DESPAIR",fr:"MON DÉSESPOIR"},{en:"MY SUFFERING",fr:"MA SOUFFRANCE"},{en:"MY ANXIETY",fr:"MON ANXIÉTÉ"},{en:"MY STRESS",fr:"MON STRESS"},{en:"THE CRIME",fr:"LE CRIME"},{en:"THE JOBS",fr:"LES JOBS"},{en:"THE HOUSES",fr:"LES MAISONS"},{en:"THE BORDERS",fr:"LES FRONTIÈRES"},{en:"THE COST OF LIVING",fr:"LE COÛT DE LA VIE"},{en:"THE HEALTH",fr:"LES SOINS DE SANTÉ"},{en:"THE EDUCATION",fr:"L'ÉDUCATION"},{en:"THE SCHOOLS",fr:"LES ECOLES"},{en:"THE CBC",fr:"RADIO CANADA"},{en:"THE QUEBEC",fr:"LE QUEBEC"},{en:"THE CITY MAYORS",fr:"LES MAIRES DES VILLES"},{en:"THE PUBLIC SECTOR",fr:"LE SECTEUR PUBLIC"},{en:"JUSTIN TRUDEAU",fr:"JUSTIN TRUDEAU"},{en:"THE LIBERALS",fr:"LES LIBÉRAUX"},{en:"THE BLOC",fr:"LE BLOC"},{en:"THE INFLATION",fr:"L'INFLATION"},{en:"THE SWAMP",fr:"LE MARÉCAGE"},{en:"THE RED TAPE",fr:"LA BUREAUCRATIE"},{en:"THE GAS PRICES",fr:"LES PRIX DU CARBURANT"},{en:"THE DEFICIT",fr:"LE DÉFICIT"},{en:"MY LEADERSHIP",fr:"MON LEADERSHIP"},{en:"MY SEAT",fr:"MON SIÈGE"},{en:"MY SECURITY CLEARANCE",fr:"HABILITATION DE SÉCURITÉ"},{en:"MY PARTY",fr:"MON PARTI"},{en:"MY LEADERSHIP",fr:"MON LEADERSHIP"},{en:"MY SEAT",fr:"MON SIÈGE"},{en:"MY RIDING",fr:"MA CIRCONSCRIPTION"},{en:"MY SECURITY CLEARANCE",fr:"HABILITATION DE SÉCURITÉ"},{en:"MY PARTY",fr:"MON PARTI"},{en:"THE WASTE",fr:"LE GASPILLAGE"},{en:"THE SUITS",fr:"LES COSTUMES"},{en:"THE SYSTEM",fr:"LE SYSTÈME"},{en:"THE ECONOMY",fr:"L'ÉCONOMIE"},{en:"THE ESTABLISHMENT",fr:"L'ESTABLISHMENT"},{en:"THE STATUS QUO",fr:"LE STATU QUO"},{en:"THE MIDDLE CLASS",fr:"LA CLASSE MOYENNE"},{en:"THE SMALL BUSINESSES",fr:"LES PETITES ENTREPRISES"},{en:"THE FUTURE GENERATIONS",fr:"LES GÉNÉRATIONS FUTURES"},{en:"THE BUREAUCRACY",fr:"LA BUREAUCRATIE"},{en:"THE BIG GOVERNMENT",fr:"LE GOUVERNEMENT TENTACULAIRE"},{en:"THE FAMILY VALUES",fr:"LES VALEURS FAMILIALES"},{en:"THE CANADIAN DREAM",fr:"LE RÊVE CANADIEN"},{en:"THE BLOC MAJORITY",fr:"LE BLOC MAJORITAIRE"},{en:"THE DEMOCRACY",fr:"LA DÉMOCRATIE"},{en:"THE REGULATIONS",fr:"LES RÈGLEMENTS"},{en:"THE DEEP STATE",fr:"L'ÉTAT PROFOND"},{en:"THE POLITICAL CORRECTNESS",fr:"LE POLITIQUEMENT CORRECT"},{en:"THE WORKING CLASS",fr:"LA CLASSE OUVRIÈRE"},{en:"THE ENVIRONMENT",fr:"L'ENVIRONNEMENT"},{en:"THE TREES",fr:"LES ARBRES"},{en:"THE SALES TAX",fr:"LA TAXE DE VENTE"},{en:"SNEAKY CARNEY",fr:"CARNEY SOURDIN"},{en:"THE POLICE",fr:"LA POLICE"},{en:"THE MEDIA",fr:"LES MÉDIAS"},{en:"THE ELITE",fr:"L'ÉLITE"},{en:"THE NATION",fr:"LA NATION"},{en:"THE PEOPLE",fr:"LE PEUPLE"},{en:"THE FUTURE",fr:"L'AVENIR"},{en:"THE COUNTRY",fr:"LE PAYS"},{en:"THE WORLD",fr:"LE MONDE"},{en:"THE PLANET",fr:"LA PLANÈTE"},{en:"THE UNIVERSE",fr:"L'UNIVERS"},{en:"THE GALAXY",fr:"LA GALAXIE"},{en:"THE COSMOS",fr:"LE COSMOS"},{en:"THE MULTIVERSE",fr:"LE MULTIVERS"},{en:"THE 51ST STATE",fr:"LE 51e ÉTAT"}];let lastVerbIndex,lastNounIndex,isFirstGeneration=!0;function generateSlogan(){if(isCustomizing&&(customSloganEn||customSloganFr))return{en:customSloganEn||"",fr:customSloganFr||""};let e,n,t=0;if(isFirstGeneration)e=Math.floor(Math.random()*verbs.length),n=nouns.findIndex((e=>"MY MISERY"===e.en)),-1===n&&(n=2),isFirstGeneration=!1;else do{if(e=Math.floor(Math.random()*verbs.length),n=Math.floor(Math.random()*nouns.length),t++,t>=10)break}while(e===lastVerbIndex||n===lastNounIndex);lastVerbIndex=e,lastNounIndex=n;const o=verbs[e],r=nouns[n];return{en:`${o.en} ${r.en}`,fr:`${o.fr} ${r.fr}`}}function createSharingImage(e,n){return new Promise((t=>{const o=new Image,r=BACKGROUND_IMAGES[currentImageKey].path;o.onload=function(){const r=o.naturalWidth,a=o.naturalHeight,i=document.createElement("canvas");i.width=r,i.height=a;i.getContext("2d").drawImage(o,0,0);const s=createSVGContent(i.toDataURL("image/webp"),calculateTextSettings(e,n,r,a),r,a,e,n),E=new Blob([s],{type:"image/svg+xml"}),l=URL.createObjectURL(E);t({url:l,svgContent:s})},o.onerror=function(){console.error("Failed to load image:",r),t({error:!0,message:"Failed to load background image"})},o.src=r}))}function calculateTextSettings(e,n,t,o){const r=BACKGROUND_IMAGES[currentImageKey],a=Math.round(o*r.textSettings.yPositionRatio),i=e.length,s=n.length,E=t*r.textSettings.fontSizeRatio,l=Math.min(Math.max(E*(25/Math.max(i,10)),r.textSettings.minFontSize.en),r.textSettings.maxFontSize.en),c=Math.min(Math.max(E*(25/Math.max(s,10)),r.textSettings.minFontSize.fr),r.textSettings.maxFontSize.fr),f=r.textSettings.enXOffset||0,m=r.textSettings.frXOffset||0;return{enY:a+r.textSettings.enYOffset,frY:a+r.textSettings.frYOffset,enX:t/2+f,frX:t/2+m,enSize:l,frSize:c}}function createSVGContent(e,n,t,o,r,a){return`\n    <svg xmlns="http://www.w3.org/2000/svg" \n        width="100%" \n        height="auto" \n        viewBox="0 0 ${t} ${o}"\n        preserveAspectRatio="xMidYMid meet">\n        <defs>\n            <style>\n                .slogan-text {\n                    font-family: Arial, sans-serif;\n                    font-weight: bold;\n                    fill: white;\n                    text-anchor: middle;\n                    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);\n                }\n                .watermark {\n                    font-family: Arial, sans-serif;\n                    font-size: 12px;\n                    fill: rgba(255, 255, 255, 0.5);\n                    text-anchor: end;\n                }\n            </style>\n        </defs>\n        \n        \x3c!-- Background image with embedded data URL --\x3e\n        <image href="${e}" width="100%" height="100%" preserveAspectRatio="xMidYMid meet" />\n        \n        \x3c!-- English slogan --\x3e\n        <text class="slogan-text" x="${n.enX}" y="${n.enY}" font-size="${n.enSize}">\n            ${r}\n        </text>\n        \n        \x3c!-- French slogan --\x3e\n        <text class="slogan-text" x="${n.frX}" y="${n.frY}" font-size="${n.frSize}">\n            ${a}\n        </text>\n        \n        \x3c!-- Watermark --\x3e\n        <text class="watermark" x="${t-15}" y="${o-10}">\n            pp-slogan-maker\n        </text>\n    </svg>`}function updateSlogan(){const e=generateSlogan(),n=document.getElementById("podium-container");n.innerHTML='<div class="loading">Generating slogan...</div>',createSharingImage(e.en,e.fr).then((t=>{const o=document.createElement("img");o.src=t.url,o.alt=`Campaign slogan: ${e.en} / ${e.fr}`,o.className="fade-in",o.dataset.svgContent=t.svgContent,n.innerHTML="",n.appendChild(o)})).catch((t=>{console.error("Error creating slogan image:",t),n.innerHTML=`\n                <div class="error-message">\n                    <p>Error generating image</p>\n                    <p>English: ${e.en}</p>\n                    <p>French: ${e.fr}</p>\n                </div>`}))}function processImage(e,n){if(!e)return console.error("No SVG content found"),void n(null,null,!0);const t=new Image,o=BACKGROUND_IMAGES[currentImageKey].path;t.onload=function(){const o=document.createElement("canvas"),r=o.getContext("2d");o.width=t.naturalWidth,o.height=t.naturalHeight,r.drawImage(t,0,0);const a=extractTextFromSVG(e);renderTextOnCanvas(r,o.width,o.height,a),n(o,e)},t.onerror=function(){console.error("Failed to load original image:",o),n(null,e,!0)},t.src=o}function cycleBackgroundImage(){const e=Object.keys(BACKGROUND_IMAGES),n=e.indexOf(currentImageKey),t=e[(n+1)%e.length];currentImageKey=t;const o=getCurrentSlogan();updateSloganWithText(o.en,o.fr)}function getCurrentSlogan(){const e=document.querySelector("#podium-container img");if(!e||!e.dataset.svgContent)return{en:"",fr:""};const n=(new DOMParser).parseFromString(e.dataset.svgContent,"image/svg+xml").querySelectorAll("text.slogan-text");let t={en:"",fr:""};return n.length>=2&&(t.en=n[0].textContent.trim(),t.fr=n[1].textContent.trim()),t}function updateSloganWithText(e,n){const t=document.getElementById("podium-container");t.innerHTML='<div class="loading">Generating slogan...</div>',createSharingImage(e,n).then((o=>{const r=document.createElement("img");r.src=o.url,r.alt=`Campaign slogan: ${e} / ${n}`,r.className="fade-in",r.dataset.svgContent=o.svgContent,t.innerHTML="",t.appendChild(r)})).catch((o=>{console.error("Error creating slogan image:",o),t.innerHTML=`\n                <div class="error-message">\n                    <p>Error generating image</p>\n                    <p>English: ${e}</p>\n                    <p>French: ${n}</p>\n                </div>`}))}function extractTextFromSVG(e){const n=(new DOMParser).parseFromString(e,"image/svg+xml").querySelectorAll("text");let t={en:{text:"",y:0,fontSize:0,x:0},fr:{text:"",y:0,fontSize:0,x:0}};return n.forEach(((e,n)=>{const o=e.textContent.trim(),r=parseFloat(e.getAttribute("y")),a=parseFloat(e.getAttribute("font-size")),i=parseFloat(e.getAttribute("x"));0===n?t.en={text:o,y:r,fontSize:a,x:i}:1===n&&(t.fr={text:o,y:r,fontSize:a,x:i})})),t}function renderTextOnCanvas(e,n,t,o){e.fillStyle="white",e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0, 0, 0, 0.7)",e.shadowBlur=4,e.shadowOffsetX=2,e.shadowOffsetY=2,e.font=`bold ${o.en.fontSize}px Arial, sans-serif`,e.fillText(o.en.text,o.en.x,o.en.y-10),e.font=`bold ${o.fr.fontSize}px Arial, sans-serif`,e.fillText(o.fr.text,o.fr.x,o.fr.y),e.font="12px Arial, sans-serif",e.fillStyle="rgba(255, 255, 255, 0.5)",e.textAlign="right",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.fillText("pp-slogan-maker",n-15,t-10)}function exportCanvas(e,n,t){const{asDownload:o=!1,filename:r="pp-slogan"}=t||{};try{exportCanvasAs(e,"jpeg",`${r}.jpg`,o)}catch(t){console.error("Error creating WebP:",t);try{exportCanvasAs(e,"png",`${r}.png`,o)}catch(e){console.error("Error creating PNG:",e),n&&exportSVG(n,`${r}.svg`,o)}}}function exportCanvasAs(e,n,t,o){if(o){const o=e.toDataURL(`image/${n}`,1),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)}else e.toBlob((e=>{const n=URL.createObjectURL(e);window.open(n,"_blank"),setTimeout((()=>URL.revokeObjectURL(n)),6e4)}),`image/${n}`,1)}function exportSVG(e,n,t){const o=new Blob([e],{type:"image/svg+xml"}),r=URL.createObjectURL(o);if(t){const e=document.createElement("a");e.href=r,e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(r)}else window.open(r,"_blank"),setTimeout((()=>URL.revokeObjectURL(r)),6e4)}function downloadShareableImage(){const e=document.querySelector("#podium-container img");e&&e.dataset.svgContent?processImage(e.dataset.svgContent,((e,n,t)=>{if(t)return alert("Failed to load background image. Falling back to SVG."),void exportSVG(n,"campaign-slogan.svg",!0);exportCanvas(e,n,{asDownload:!0})})):console.error("No image or SVG content found")}function shareInNewTab(){const e=document.querySelector("#podium-container img");e&&e.dataset.svgContent?processImage(e.dataset.svgContent,((e,n,t)=>{t?exportSVG(n,null,!1):exportCanvas(e,n,{asDownload:!1})})):console.error("No image or SVG content found")}function downloadAsSVG(e){const n=new Blob([e],{type:"image/svg+xml"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download="campaign-slogan.svg",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}let isCustomizing=!1,customSloganEn="",customSloganFr="";function toggleCustomizeForm(){const e=document.getElementById("customize-form");isCustomizing=!isCustomizing,isCustomizing?(e.classList.remove("hidden"),document.getElementById("customSloganEn").focus()):(e.classList.add("hidden"),customSloganEn="",customSloganFr="",document.getElementById("customSloganEn").value="",document.getElementById("customSloganFr").value="")}function closeCustomizeForm(){const e=document.getElementById("customize-form");isCustomizing&&(isCustomizing=!1,e.classList.add("hidden"),customSloganEn="",customSloganFr="",document.getElementById("customSloganEn").value="",document.getElementById("customSloganFr").value="")}function resetCustomInputs(){document.getElementById("customSloganEn").value="",document.getElementById("customSloganFr").value="",customSloganEn="",customSloganFr="",updateCustomSlogan()}function updateCustomSlogan(){customSloganEn=document.getElementById("customSloganEn").value.trim().toUpperCase(),customSloganFr=document.getElementById("customSloganFr").value.trim().toUpperCase(),customSloganEn||customSloganFr?createSharingImage(customSloganEn,customSloganFr).then((e=>{const n=document.createElement("img");n.src=e.url,n.alt=`Campaign slogan: ${customSloganEn} / ${customSloganFr}`,n.className="fade-in",n.dataset.svgContent=e.svgContent;const t=document.getElementById("podium-container");t.innerHTML="",t.appendChild(n)})).catch((e=>{console.error("Error creating custom slogan image:",e);document.getElementById("podium-container").innerHTML=`\n                    <div class="error-message">\n                        <p>Error generating image</p>\n                        <p>English: ${customSloganEn}</p>\n                        <p>French: ${customSloganFr}</p>\n                    </div>`})):updateSlogan()}function addAnimationStyles(){if(!document.querySelector("style#slogan-animations")){const e=document.createElement("style");e.id="slogan-animations",e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; transform: translateY(10px); }\n                to { opacity: 1; transform: translateY(0); }\n            }\n            .fade-in {\n                animation: fadeIn 0.5s ease-in-out;\n            }\n            .loading {\n                font-family: Arial, sans-serif;\n                text-align: center;\n                padding: 20px;\n                color: #333;\n            }\n            .error-message {\n                font-family: Arial, sans-serif;\n                text-align: center;\n                padding: 20px;\n                color: #721c24;\n                background-color: #f8d7da;\n                border: 1px solid #f5c6cb;\n                border-radius: 4px;\n            }\n        ",document.head.appendChild(e)}}document.addEventListener("DOMContentLoaded",(()=>{addAnimationStyles(),updateSlogan(),document.getElementById("generateButton").addEventListener("click",(()=>{isCustomizing&&closeCustomizeForm(),updateSlogan()})),document.getElementById("downloadButton").addEventListener("click",downloadShareableImage),document.getElementById("shareButton").addEventListener("click",shareInNewTab),document.getElementById("customizeButton").addEventListener("click",toggleCustomizeForm),document.getElementById("customSloganEn").addEventListener("input",(()=>{clearTimeout(window.customSloganTimer),window.customSloganTimer=setTimeout(updateCustomSlogan,300)})),document.getElementById("customSloganFr").addEventListener("input",(()=>{clearTimeout(window.customSloganTimer),window.customSloganTimer=setTimeout(updateCustomSlogan,300)})),document.getElementById("cycleImageButton").addEventListener("click",cycleBackgroundImage)}));